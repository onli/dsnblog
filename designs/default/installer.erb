<%# -*- encoding : utf-8 -*- %>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <title>First Use Installer</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="<%= url '/css/main.css' %>">
    </head>

    <body>
        <div id="content">
            <h1>Installation</h1>
            <% if ! authorized? %>
                <h2>Step 1/2</h2>
                <p>Please sign in:
                    <script src="<%= settings.browserid_url %>/include.js" type="text/javascript"></script>
                    <script type="text/javascript">
                        function _browserid_login() {
                            navigator.id.getVerifiedEmail(function(assertion) {
                            if (assertion) {
                                document.forms._browserid_assert.assertion.value = assertion;
                                document.forms._browserid_assert.submit();
                            } else {
                                // TODO: handle failure case?
                                console.log("browserid login failure");
                            }
                            });
                        }
                    </script>
                    <form name="_browserid_assert" action="<%= url '/_browserid_assert' %>" method="post">
                        <input type="hidden" name="redirect" value="<%= request.url %>">
                        <input type="hidden" name="assertion" value="">
                    </form>
                    <a href="#"><img src="<%= url '/img/browserid.png' %>" id="browserid_login_button" border=0 onClick="_browserid_login()" /></a>
                </p>
                <p>The mail address used will be marked as being admin.</p>
            <% else %>
                <h2>Step 2/2</h2>
                <form method="POST" action="<%= url '/addAdmin' %>">
                    <label>Displayname: <input name="name" type="text" required></input></label>
                    <button type="submit">OK</button>
                    <p>This name will be shown as your author name</p>
                </form>
            <% end %>
        </div>
    </body>
</html>
